'use strict';mix_d("P13NSCCards__p13n-desktop-carousel:p13n-desktop-carousel__t8JHJUs9","exports tslib @c/aui-carousel @c/dom @c/remote-operations @c/scoped-dom @p/A @p/a-carousel-framework @c/browser-operations @c/metrics @c/aui-modal @c/aui-untrusted-ajax @c/logger".split(" "),function(x,l,C,D,E,F,G,H,I,t,J,K,L){function k(a){return a&&"object"===typeof a&&"default"in a?a:{"default":a}}var M=k(C),N=k(E),g=k(F),m=k(G),O=k(H),u=k(I),P=k(t),Q=k(J),R=k(K),q=k(L),v=function(a){t.count(a,(t.count(a)||
0)+1)},S=function(a){var d=Array.prototype.slice.call(a.querySelectorAll("[data-metrics]"));d.push(a);d.forEach(function(a){if(a&&a.dataset&&a.dataset.metrics){var c=JSON.parse(a.dataset.metrics),b;for(b in c)c.hasOwnProperty(b)&&t.count(b,c[b]);a.removeAttribute("data-metrics")}})},T=function(){var a=g["default"].cardRoot.querySelector(".p13n-edit-your-recs-button"),d=g["default"].cardRoot.querySelector(".p13n-kebab-button-edit-recs-bottom-sheet");if(d&&a){var b=u["default"].setup();P["default"].count("mobile-carousel-card:p13nEditRecsBottomSheet:rendered",
1);b.define("show-sheet","click",function(){v("mobile-carousel-card:p13nEditRecsBottomSheet:show");v("mobile-carousel-card:internal:p13nEditRecsBottomSheet:show")});b.attach("show-sheet",d);a.addEventListener("click",function(){v("mobile-carousel-card:p13nEditRecsBottomSheet:notInterested")})}},V=function(a){return l.__awaiter(void 0,void 0,void 0,function(){var d,b,c,e,f;return l.__generator(this,function(h){d=g["default"].cardRoot.querySelector(".report-problem-modal-root");if(!d)return[2];b={a11yOpenMessage:"A modal for internal users to report problems with recommendations",
hideHeader:!1,width:560};c=Q["default"].create("report-flag-modal",".report-problem-modal-root",b);e=u["default"].setup();f=g["default"].cardRoot.querySelector(".report-flag");e.define("show","click",function(){c.show()});e.attach("show",f);U(a,c);return[2]})})},U=function(a,d){var b=g["default"].cardRoot.querySelector(".report-flag"),c=u["default"].setup();c.define("showFlag","mouseover",function(){b.classList.remove("report-flag-hide")});c.define("hideFlag","mouseout",function(){b.classList.add("report-flag-hide")});
c.attach("showFlag",a);c.attach("hideFlag",a);var e=g["default"].cardRoot.querySelector(".internal-flag-form");e.onsubmit=function(b){return W(e,b,a)};m["default"].on("a:popover:hide:"+d.id,function(){e.reset();var a=e.querySelector(".internal-flag-form-end").nextSibling;a&&a.classList.contains("report-problem-message")&&(a.innerText="")})},W=function(a,d,b){d.preventDefault();d=a.querySelector(".internal-flag-env-data").dataset;var c=a.querySelector(".internal-flag-title-text").value,e=a.querySelector(".internal-flag-description").firstElementChild.value,
f=a.querySelector(".internal-flag-alias").value,h=a.querySelector(".internal-flag-form-end");a=g["default"].cardRoot.querySelectorAll(".a-carousel-card");b=X(b,a.length);c="Internal user reported issue '"+c+"' with widget: "+g["default"].cardRoot.querySelector(".a-carousel-heading").innerText;d=Y(a,b,e,f,d);R["default"].post("https://p13ngoals.corp.amazon.com/sims",{accepts:"text/html, application/json",contentType:"application/json;charset=UTF-8"},{sim_params:{assigned_folder:"9c9c97c9-6f69-4dba-a55d-26045c6a3068",
description:d,descriptionContentType:"text/amz-markdown-sim",extensions:{tt:{assignedGroup:"P13N Report a Problem CX",category:"Website",impact:5,item:"Report a Problem CX",type:"Personalization"}},tags:[{id:"internal-problem-generated"}],title:c}}).then(function(a){z(h,!0,a)}).catch(function(a){z(h,!1,a)});return!1},X=function(a,d){if(!a.dataset.aCarouselOptions)return q["default"].log("Empty ASIN List in carouselElement.dataset.aCarouselOptions","ERROR"),[];a=JSON.parse(a.dataset.aCarouselOptions).ajax.id_list;
var b=g["default"].cardRoot.querySelector(".a-carousel-firstvisibleitem");b=(Number(b.value)||1)-1;return a.map(function(a){return JSON.parse(a).id}).slice(b,b+d)},Y=function(a,d,b,c,e){for(var f="",h=0;h<a.length;h++){var y=a[h].querySelector(".a-dynamic-image");f+=(y?"![]("+y.src+")":"IMAGE MISSING")+"\nASIN: "+(d[h]?d[h]:"ASIN MISSING")+"\n\n"}return"**This SIM-T ticket is created by the 'Report a Problem' internal tool. To know more, here's its wiki: https://w.amazon.com/bin/view/Personalization/CoreRecommendations/Projects/Canaries/Report-a-Problem-UX-on-P13NWidget/UserGuide/**\n\n**Alias:** ["+
(c+"](https://phonetool.amazon.com/users/"+c+")\n**Comment:** "+b+"\n\n**Widget Group ID:** "+e.widgetGroupId+"\n**Strategy ID:** "+e.strategyId+"\n**CTI:** "+e.cti+"\n**Facets:** ")+(e.facets+"\n**Content Reftag:** "+e.reftag+"\n"+(""!==e.baseAsin?"**Page ASIN:** "+e.baseAsin+"\n":"")+"\n**SessionID:** ")+(e.sessionId+"\n**MarketplaceID:** "+e.marketplaceId+"\n**Device Type:** "+e.deviceType+"\n\n**List of ASINs:**\n\n")+f},z=function(a,d,b){var c=a.nextSibling;c&&c.classList.contains("report-problem-message")||
(c=document.createElement("h5"),c.classList.add("report-problem-message"),a.after(c));d?(c.classList.remove("a-color-error"),b.responseBody&&"object"===typeof b.responseBody?b.responseBody.response&&b.responseBody.response.id?c.innerHTML="Success, here's the <a href=\"https://t.corp.amazon.com/"+b.responseBody.response.id+'" target="_blank">SIM-T ticket</a> you created.':(q["default"].log("Fail to find the id of the SIM-T ticket created in the response body of response data.","ERROR"),c.innerText=
"Success, but we could not find the link to the SIM-T ticket."):(q["default"].log("The response body of response data is not an object.","ERROR"),c.innerText="Success, but we could not find the link to the SIM-T ticket.")):(c.classList.add("a-color-error"),c.innerText="string"===typeof b?b:"Oops! Something went wrong. Please try again.")},A=/(?=[ \-\/])|(?=[\u3105-\u312F])|(?=[\u31A0-\u31BA])|(?=[\u4E00-\u9FD5])|(?=[\u3400-\u4DB5])|(?=[\uF900-\uFAFF])|(?=[\u3040-\u309F])|(?=[\u30A0-\u30FF])|(?=[\u3190-\u319F])/,
B=/[^\/\-\[\]():\s]/,Z=function(a){var d=m["default"].$("<div>")[0];d.classList.add("p13n-sc-offscreen-truncate");var b=parseInt(a.getAttribute("data-rows")||"2",10),c=function(){var b=a.innerHTML;a.innerHTML="&hellip;";var c=a.clientHeight;a.innerHTML=b;return c}();if(b){if(c){var e=function(a){d.innerHTML=a;return Math.round(d.clientHeight/c)<=b},f=function(b,c){b=b.split(c);var e=Math.floor(a.clientWidth/12),h=function(b){d.classList.add("p13n-sc-offscreen-truncate");d.style.overflow="hidden";
d.textContent=b;a.appendChild(d);b=a.clientWidth>=a.scrollWidth;a.removeChild(d);return b},f=function(a){var b=a.length-e;a.trim().length>e&&!h(a)&&Array.prototype.slice.call(a).map(function(a,c){return c>e&&c<=b&&B.test(a)?"&shy;"+a:a});return a};return b.map(function(a){return f(a)}).join("")};return{truncate:function(){var b=a.innerHTML.trim(),c=a.textContent||"";b=f(b,A);a.appendChild(d);if(e(b))a.removeChild(d),a.innerHTML=b;else{var n=b.split(A);for(var g=1,p=n.length,l,k,r=0;g!==p;)if(l=Math.floor((p+
g)/2),k=n.slice(0,l).join("")+"&hellip;",e(k)){if(1>=p-l){for(r=l;0<r&&!B.test(n[r-1]);)r--;break}g=l}else p=l;n=0===r?void 0:n.slice(0,r).join("")+"&hellip;";n?(a.innerHTML=n,a.setAttribute("title",c)):(q["default"].log("Unable to successfully truncate line "+b,"ERROR"),a.removeChild(d))}}}}q["default"].log("Truncation element does not have a line height or it is zero","ERROR")}else q["default"].log("Truncation element missing necessary line number data","ERROR")},aa=function(a){var d=Array.prototype.slice.call(a.getElementsByClassName("p13n-sc-truncate"));
a=a.getElementsByClassName("p13n-sc-truncate-fallback");(window.CSS&&CSS.supports&&CSS.supports("-webkit-line-clamp","1")?d:d.concat(Array.prototype.slice.call(a))).filter(function(a){return!!a.offsetParent}).map(function(a){var b=Z(a);b&&(b.truncate(),a.classList.add("p13n-sc-truncated"),a.classList.remove("p13n-sc-truncate"),a.classList.remove("p13n-sc-truncate-fallback"),a.className=a.className.replace(/p13n-sc-line-clamp-\d/g,""))})},w=function(a){return 0===Math.floor(a/10)?"0"+a.toString():
a.toString()},ba=function(a){if(null!==a){var d=a.dataset.endtime;if(d)var b=setInterval(function(){a.innerText===a.dataset.expiredstring&&clearInterval(b);a:{var c=parseInt(d,10);var e=Date.now();var f=a.dataset.dayscountdowntoendtemplate,h=a.dataset.expiredstring,l=a.dataset.hourscountdowntoendtemplate,g=a.dataset.minutescountdowntoendtemplate;if(e<=c){h=null;var k=c-e;e=Math.floor(k/864E5);var p=Math.floor(k/36E5);c=Math.floor(k/6E4%60);k=Math.floor(k/1E3%60);if(1<e&&f&&(h=f,null!==h)){f=h.replace("${daysCount}",
e.toString());a.innerText=f;break a}g&&l&&(h=0===p?g:l);null!==h&&(f=h.replace("_hours_",w(p)),f=f.replace("_minutes_",w(c)),f=f.replace("_seconds_",w(k)),a.innerText=f)}else h&&(a.innerText=h)}},1E3)}},ca={initCarousel:function(a){return l.__awaiter(void 0,void 0,void 0,function(){var d,b,c;return l.__generator(this,function(e){d=(a||{}).afterPageLoaded;b=g["default"].cardRoot.classList.contains("p13n-sc-shoveler")?[g["default"].cardRoot]:Array.prototype.slice.call(g["default"].cardRoot.getElementsByClassName("p13n-sc-shoveler"));
c=N["default"].setup(["getCarouselItems"]);if(null===b||void 0===b||!b.length)return[2];b.forEach(function(a){return l.__awaiter(void 0,void 0,void 0,function(){var b,e,f,k,g;return l.__generator(this,function(h){switch(h.label){case 0:b=function(){m["default"].loadDynamicImage("[data-name]='"+g+"' .p13n-sc-dynamic-image");aa(a);S(a);null===d||void 0===d?void 0:d(a)};b();if(a.classList.contains("p13n-carousel-initialized"))return[2];a.classList.add("p13n-carousel-initialized");e=O["default"].getCarousel(D.unscope(a));
f=M["default"].getCarousel(a);k=a.dataset||{};g=e.getAttr("name");return[4,Promise.all([f.initialized,V(a)])];case 1:return h.sent(),T(),m["default"].on("a:carousel:"+g+":change:pageSize",b),m["default"].on("a:carousel:"+g+":change:loading",b),m["default"].on("a:carousel:"+g+":change:animating",b),m["default"].on("a:carousel:"+g+":change:fetchedItems",b),f.attachRemoteOperation(function(a){var b=a.indexes;a=a.ids;return c.getCarouselItems(l.__assign(l.__assign({},k),{ids:a,indexes:b,offset:String(b[0]||
0)}))}),[2]}})})});return[2]})})}},da=function(){var a,d=Array.prototype.slice.call(g["default"].cardRoot.querySelectorAll('[class*="dealsCardDealTimer"]'));try{for(var b=l.__values(d),c=b.next();!c.done;c=b.next())ba(c.value)}catch(f){var e={error:f}}finally{try{c&&!c.done&&(a=b.return)&&a.call(b)}finally{if(e)throw e.error;}}};x._operationNames=["getCarouselItems"];x.card=function(){return l.__awaiter(void 0,void 0,void 0,function(){return l.__generator(this,function(a){switch(a.label){case 0:return[4,
ca.initCarousel({afterPageLoaded:da})];case 1:return a.sent(),[2]}})})}});
